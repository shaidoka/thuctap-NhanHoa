# Scanning unsupported systems

Vulnerability Detector module hỗ trợ một danh sách bao quát các OS. Tuy vậy, module này không tự động định nghĩa feed cho tất cả OS đang có. OS mà không có nguồn dữ liệu được định nghĩa từ trước là các hệ thống không được hỗ trợ. Ví dụ là Linux Mint hay Oracle Linux chẳng hạn. Để scan các OS không được hỗ trợ, ta phải cấu hình Vulnerability Detector module để sử dụng các nguồn dữ liệu có sẵn của OS được hỗ trợ. Để làm điều này, ta có thể sử dụng tùy chọn ```allow```. Tùy chọn này chỉ định module có thể scan 1 OS không được hỗ trợ với với dữ liệu được thiết lập.

## Kiểm tra tên được đăng ký của OS

Tên được đăng ký của OS (hay registered name of OS) trên endpoint mà bạn cài đặt Wazuh agent là tên trong Wazuh database. Nó có thể hơi khác so với bạn nghĩ. Bạn có thể kiểm tra tên này với các bước sau:

1. Khởi tạo 1 JSON Web Token (JWT) cho việc xác thực đến Wazuh server bằng cách chạy lệnh sau. Credential API mặc định là ```wazuh:wazuh```

```sh
TOKEN=$(curl -u <USER>:<PASSWORD> -k -X GET "https://<MANAGER_IP>:55000/security/user/authenticate?raw=true")
```

Sau đó ta có thể kiểm tra kết quả bằng lệnh ```echo $TOKEN``` để chắc chắn là token đã được khởi tạo, ví dụ output có thể như sau

```sh
eyJhbGciOiJFUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ3YXp1aCIsImF1ZCI6IldhenVoIEFQSSBSRVNUIiwibmJmIjoxNjQzMDExMjQ0LCJleHAiOjE2NDMwMTIxNDQsInN1YiI6IndhenVoIiwicnVuX2FzIjpmYWxzZSwicmJhY19yb2xlcyI6WzFdLCJyYmFjX21vZGUiOiJ3aGl0ZSJ9.Ad6zOZvx0BEV7K0J6s3pIXAXTWB-zdVfxaX2fotLfZMQkiYPMkwDaQHUFiOInsWJ_7KZV3y2BbhEs9-kBqlJAMvMAD0NDBPhEQ2qBd_iutZ7QWZECd6eYfIP83xGqH9iqS7uMI6fXOKr3w4aFV13Q6qsHSUQ1A-1LgDnnDGGaqF5ITYo
```

2. Chạy lệnh sau để sử dụng Wazuh RESTful API endpoint ```GET /agents```

```sh
curl -k -X GET "https://localhost:55000/agents?pretty=true&agents_list=<AGENT_ID>&select=os.name,os.major" -H  "Authorization: Bearer $TOKEN"
```

Out có dạng

```sh
{
   "data": {
      "affected_items": [
         {
            "os": {
               "major": "8",
               "name": "CloudLinux"
            },
            "id": "002"
         }
      ],
      "total_affected_items": 1,
      "total_failed_items": 0,
      "failed_items": []
   },
   "message": "All selected agents information was returned",
   "error": 0
}
```

Cách làm trên hơi dài, ta có thể check thẳng trong database

```sh
sqlite3 /var/ossec/queue/db/global.db "SELECT OS_NAME, OS_MAJOR FROM AGENT WHERE ID = <AGENTID>;"
```

Đầu ra có dạng

```sh
CloudLinux|8
```

## Thiết lập Vulnerability Detector để bao gồm các OS không được hỗ trợ

Sử dụng format ```OS_name-OS_major``` với thuộc tính ```allow``` để bao gồm OS vào. Thêm 1 danh sách hệ thống cách nhau bởi dấu phẩy để bao gồm nhiều OS

Ví dụ, nếu bạn muốn scan Kali Linux 2022 sử dụng Debian vulnerability feed và scan PopOS 18 hay Linux Mint 19 sử dụng Ubuntu 18 (bionic) feed thì cấu hình như này:

```sh
<provider name="canonical">
  <enabled>yes</enabled>
  <os allow="Kali GNU/Linux-2022">debian</os>
  <os allow="Linux Mint-19, Pop!_OS-18">bionic</os>
  <update_interval>1h</update_interval>
</provider>
```